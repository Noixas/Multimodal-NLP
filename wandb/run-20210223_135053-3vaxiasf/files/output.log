23/02/2021 01:50:55 PM : INFO - Data path checked..
23/02/2021 01:50:55 PM : INFO - Model save path checked..
23/02/2021 01:50:55 PM : INFO - config JSON path checked..

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Running training with the following parameters: 
23/02/2021 01:50:55 PM : INFO - Tensorboard Visualization path checked..
23/02/2021 01:50:55 PM : INFO - Cleaning Visualization path of older tensorboard files...


data_path : ./dataset
model_path : ./model_checkpoints
vis_path : ./vis_checkpoints
model_save_name : meme.pt
no_model_checkpoints : False
remove_checkpoints : False
config : config/uniter-base.json
feature_path : ./dataset/own_features
pretrained_model_file : uniter-base.pt
max_txt_len : 60
max_bb : 100
min_bb : 10
num_bb : 36
optimizer : adam
loss_func : bce_logits
optimize_for : aucroc
scheduler : warmup_cosine
beta1 : 0.9
beta2 : 0.999
batch_size : 16
num_workers : 0
gradient_accumulation : 2
max_grad_norm : 5
pos_wt : 1.0
lr : 3e-05
warmup_steps : 500
weight_decay : 0.001
max_epoch : 30
lr_decay_step : 3
lr_decay_factor : 0.8
patience : 5.0
early_stop_thresh : 0.001
seed : 43
log_every : 2000
fc_dim : 64
dropout : 0.2
filter_text : True
no_normalize_img : True
train_filename : train.jsonl
upsample_multiplier : 3
note : 
race_gender_hidden_size : 8
device : cuda
n_classes : 1

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
filter text True
Confounders upsampled by 3 times. 
 From 1903  samples to 5709
Upsample both parts of confounders, hateful and non hateful - option 2
Saved confounder samples to: 
./dataset/train_upsampled_confounders_3x_times.jsonl
Loaded dataset contains  14209 samples
filter text True
Loaded dataset contains  500 samples
filter text True
Loaded dataset contains  1000 samples
23/02/2021 01:51:06 PM : INFO - Using pretrained UNITER base model ./model_checkpoints/uniter-base.pt
23/02/2021 01:51:06 PM : INFO - Model config {
  "attention_probs_dropout_prob": 0.1,
  "hidden_act": "gelu",
  "hidden_dropout_prob": 0.1,
  "hidden_size": 768,
  "initializer_range": 0.02,
  "intermediate_size": 3072,
  "max_position_embeddings": 512,
  "num_attention_heads": 12,
  "num_hidden_layers": 12,
  "type_vocab_size": 2,
  "vocab_size": 28996
}



====================================================================================================
					 Training Network
====================================================================================================

Beginning training at:  2021-02-23 13:51:10.011613 

23/02/2021 01:55:35 PM : INFO - New High Score! Saving model...

Epoch: 1/30,            
train_loss = 0.5922,  train_acc = 0.6610,  train_prec = 0.4775,  train_recall = 0.6835,  train_f1 = 0.5622,  train_aucroc = 0.7270,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 0.6646,  eval_acc = 0.6720,  eval_prec = 0.5304,  eval_recall = 0.7318,  eval_f1 = 0.6150,  eval_aucroc = 0.7312,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002670
Elapsed Time:  00:04:25.82
23/02/2021 01:55:37 PM : INFO - current patience: 0

Epoch: 2/30,            
train_loss = 0.2905,  train_acc = 0.8871,  train_prec = 0.8577,  train_recall = 0.8907,  train_f1 = 0.8739,  train_aucroc = 0.9459,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 0.7420,  eval_acc = 0.6760,  eval_prec = 0.5223,  eval_recall = 0.7457,  eval_f1 = 0.6143,  eval_aucroc = 0.7364,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002998
Elapsed Time:  00:08:54.6023/02/2021 02:00:04 PM : INFO - New High Score! Saving model...

23/02/2021 02:00:06 PM : INFO - current patience: 0

Epoch: 3/30,            
train_loss = 0.1451,  train_acc = 0.9519,  train_prec = 0.9447,  train_recall = 0.9496,  train_f1 = 0.9471,  train_aucroc = 0.9849,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 0.9887,  eval_acc = 0.6720,  eval_prec = 0.5020,  eval_recall = 0.7515,  eval_f1 = 0.6019,  eval_aucroc = 0.7531,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002992
Elapsed Time:  00:13:22.1323/02/2021 02:04:32 PM : INFO - New High Score! Saving model...

23/02/2021 02:04:33 PM : INFO - current patience: 0
23/02/2021 02:08:53 PM : INFO - current patience: 1

Epoch: 4/30,            
train_loss = 0.0904,  train_acc = 0.9726,  train_prec = 0.9691,  train_recall = 0.9708,  train_f1 = 0.9699,  train_aucroc = 0.9927,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.1615,  eval_acc = 0.7020,  eval_prec = 0.5709,  eval_recall = 0.7663,  eval_f1 = 0.6543,  eval_aucroc = 0.7515,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002982
Elapsed Time:  00:17:42.99

Epoch: 5/30,            
train_loss = 0.0717,  train_acc = 0.9778,  train_prec = 0.9751,  train_recall = 0.9762,  train_f1 = 0.9757,  train_aucroc = 0.9955,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.0754,  eval_acc = 0.6900,  eval_prec = 0.6154,  eval_recall = 0.7170,  eval_f1 = 0.6623,  eval_aucroc = 0.7735,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002968
Elapsed Time:  00:21:58.49
23/02/2021 02:13:08 PM : INFO - New High Score! Saving model...
23/02/2021 02:13:09 PM : INFO - current patience: 0
23/02/2021 02:17:26 PM : INFO - current patience: 1

Epoch: 6/30,            
train_loss = 0.0670,  train_acc = 0.9798,  train_prec = 0.9792,  train_recall = 0.9766,  train_f1 = 0.9779,  train_aucroc = 0.9961,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.3797,  eval_acc = 0.6660,  eval_prec = 0.4980,  eval_recall = 0.7410,  eval_f1 = 0.5956,  eval_aucroc = 0.7430,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002949
Elapsed Time:  00:26:16.06

Epoch: 7/30,            
train_loss = 0.0689,  train_acc = 0.9780,  train_prec = 0.9750,  train_recall = 0.9768,  train_f1 = 0.9759,  train_aucroc = 0.9959,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.1345,  eval_acc = 0.6640,  eval_prec = 0.4858,  eval_recall = 0.7453,  eval_f1 = 0.5882,  eval_aucroc = 0.7453,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002927
Elapsed Time:  00:30:27.2523/02/2021 02:21:37 PM : INFO - current patience: 2


Epoch: 8/30,            
train_loss = 0.0662,  train_acc = 0.9781,  train_prec = 0.9748,  train_recall = 0.9771,  train_f1 = 0.9760,  train_aucroc = 0.9963,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.5220,  eval_acc = 0.6640,  eval_prec = 0.4777,  eval_recall = 0.7516,  eval_f1 = 0.5842,  eval_aucroc = 0.7354,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002900
Elapsed Time:  00:34:34.5923/02/2021 02:25:44 PM : INFO - current patience: 3

23/02/2021 02:29:51 PM : INFO - current patience: 4

Epoch: 9/30,            
train_loss = 0.0570,  train_acc = 0.9817,  train_prec = 0.9796,  train_recall = 0.9802,  train_f1 = 0.9799,  train_aucroc = 0.9976,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.5865,  eval_acc = 0.6540,  eval_prec = 0.3765,  eval_recall = 0.8304,  eval_f1 = 0.5181,  eval_aucroc = 0.7435,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002869
Elapsed Time:  00:38:41.23

Epoch: 10/30,            
train_loss = 0.0629,  train_acc = 0.9799,  train_prec = 0.9778,  train_recall = 0.9781,  train_f1 = 0.9779,  train_aucroc = 0.9971,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.5731,  eval_acc = 0.6520,  eval_prec = 0.3765,  eval_recall = 0.8230,  eval_f1 = 0.5167,  eval_aucroc = 0.7632,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002835
Elapsed Time:  00:42:47.24

----------------------------------------------------------------------------------------------------

--------------------------------------------------
Best Validation scores:
--------------------------------------------------

Val accuracy of best model = 69.000
23/02/2021 02:33:57 PM : INFO - current patience: 5
Val AUC-ROC of best model = 77.346
Val precision of best model = 61.538
Val recall of best model = 71.698
Val f1 of best model = 66.231

--------------------------------------------------
		Evaluating on test set
--------------------------------------------------
23/02/2021 02:33:57 PM : INFO - Training terminated early because the Validation aucroc did not improve for  5.0  epochs
23/02/2021 02:33:57 PM : INFO - Using UNITER model ./model_checkpoints/meme.pt
23/02/2021 02:33:58 PM : INFO - Exporting dev_seen predictions...
23/02/2021 02:34:01 PM : INFO - Finished export of dev_seen predictions
23/02/2021 02:34:01 PM : INFO - Optimal threshold on validation dataset: 0.5000 (accuracy=69.00%)
23/02/2021 02:34:01 PM : INFO - Export and testing on test_seen...
23/02/2021 02:34:06 PM : INFO - Finished export of test predictions
