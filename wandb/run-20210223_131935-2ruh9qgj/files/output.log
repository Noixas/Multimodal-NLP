23/02/2021 01:19:37 PM : INFO - Data path checked..

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Running training with the following parameters: 
23/02/2021 01:19:37 PM : INFO - Model save path checked..
23/02/2021 01:19:37 PM : INFO - config JSON path checked..
23/02/2021 01:19:37 PM : INFO - Tensorboard Visualization path checked..
23/02/2021 01:19:37 PM : INFO - Cleaning Visualization path of older tensorboard files...


data_path : ./dataset
model_path : ./model_checkpoints
vis_path : ./vis_checkpoints
model_save_name : meme.pt
no_model_checkpoints : False
remove_checkpoints : False
config : config/uniter-base.json
feature_path : ./dataset/own_features
pretrained_model_file : uniter-base.pt
max_txt_len : 60
max_bb : 100
min_bb : 10
num_bb : 36
optimizer : adam
loss_func : bce_logits
optimize_for : aucroc
scheduler : warmup_cosine
beta1 : 0.9
beta2 : 0.999
batch_size : 16
num_workers : 0
gradient_accumulation : 2
max_grad_norm : 5
pos_wt : 1.0
lr : 3e-05
warmup_steps : 500
weight_decay : 0.001
max_epoch : 30
lr_decay_step : 3
lr_decay_factor : 0.8
patience : 5.0
early_stop_thresh : 0.001
seed : 43
log_every : 2000
fc_dim : 64
dropout : 0.2
filter_text : False
no_normalize_img : True
train_filename : train.jsonl
upsample_multiplier : 3
note : 
race_gender_hidden_size : 8
device : cuda
n_classes : 1

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
filter text False
Confounders upsampled by 3 times. 
 From 1903  samples to 5709
Upsample both parts of confounders, hateful and non hateful - option 2
Saved confounder samples to: 
./dataset/train_upsampled_confounders_3x_times.jsonl
Loaded dataset contains  14209 samples
filter text False
Loaded dataset contains  500 samples
filter text False
Loaded dataset contains  1000 samples
23/02/2021 01:19:47 PM : INFO - Using pretrained UNITER base model ./model_checkpoints/uniter-base.pt
23/02/2021 01:19:47 PM : INFO - Model config {
  "attention_probs_dropout_prob": 0.1,
  "hidden_act": "gelu",
  "hidden_dropout_prob": 0.1,
  "hidden_size": 768,
  "initializer_range": 0.02,
  "intermediate_size": 3072,
  "max_position_embeddings": 512,
  "num_attention_heads": 12,
  "num_hidden_layers": 12,
  "type_vocab_size": 2,
  "vocab_size": 28996
}



====================================================================================================
					 Training Network
====================================================================================================

Beginning training at:  2021-02-23 13:19:51.178374 


Epoch: 1/30,            
train_loss = 0.5498,  train_acc = 0.7137,  train_prec = 0.6439,  train_recall = 0.7031,  train_f1 = 0.6722,  train_aucroc = 0.7886,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 0.7882,  eval_acc = 0.6260,  eval_prec = 0.3360,  eval_recall = 0.7830,  eval_f1 = 0.4703,  eval_aucroc = 0.7215,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002670
Elapsed Time:  00:04:10.7223/02/2021 01:24:01 PM : INFO - New High Score! Saving model...

23/02/2021 01:24:03 PM : INFO - current patience: 0

Epoch: 2/30,            
train_loss = 0.2723,  train_acc = 0.8989,  train_prec = 0.8830,  train_recall = 0.8940,  train_f1 = 0.8885,  train_aucroc = 0.9517,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 0.7470,  eval_acc = 0.6920,  eval_prec = 0.5385,  eval_recall = 0.7688,  eval_f1 = 0.6333,  eval_aucroc = 0.7707,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002998
Elapsed Time:  00:08:31.0023/02/2021 01:28:22 PM : INFO - New High Score! Saving model...

23/02/2021 01:28:23 PM : INFO - current patience: 0
23/02/2021 01:32:33 PM : INFO - current patience: 1

Epoch: 3/30,            
train_loss = 0.1340,  train_acc = 0.9550,  train_prec = 0.9518,  train_recall = 0.9495,  train_f1 = 0.9507,  train_aucroc = 0.9870,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.1037,  eval_acc = 0.7100,  eval_prec = 0.5223,  eval_recall = 0.8269,  eval_f1 = 0.6402,  eval_aucroc = 0.7558,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002992
Elapsed Time:  00:12:42.61

Epoch: 4/30,            
train_loss = 0.0871,  train_acc = 0.9729,  train_prec = 0.9697,  train_recall = 0.9708,  train_f1 = 0.9703,  train_aucroc = 0.9933,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.1428,  eval_acc = 0.6700,  eval_prec = 0.4777,  eval_recall = 0.7662,  eval_f1 = 0.5885,  eval_aucroc = 0.7547,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002982
Elapsed Time:  00:16:55.13
23/02/2021 01:36:46 PM : INFO - current patience: 2

Epoch: 5/30,            
train_loss = 0.0740,  train_acc = 0.9771,  train_prec = 0.9756,  train_recall = 0.9741,  train_f1 = 0.9749,  train_aucroc = 0.9949,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.0685,  eval_acc = 0.7120,  eval_prec = 0.5628,  eval_recall = 0.7943,  eval_f1 = 0.6588,  eval_aucroc = 0.7616,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002968
Elapsed Time:  00:21:21.0623/02/2021 01:41:12 PM : INFO - current patience: 3


Epoch: 6/30,            
train_loss = 0.0630,  train_acc = 0.9804,  train_prec = 0.9799,  train_recall = 0.9771,  train_f1 = 0.9785,  train_aucroc = 0.9966,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.3868,  eval_acc = 0.6820,  eval_prec = 0.5344,  eval_recall = 0.7500,  eval_f1 = 0.6241,  eval_aucroc = 0.7197,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002949
Elapsed Time:  00:25:30.7323/02/2021 01:45:21 PM : INFO - current patience: 4

23/02/2021 01:49:48 PM : INFO - current patience: 5

Epoch: 7/30,            
train_loss = 0.0755,  train_acc = 0.9753,  train_prec = 0.9714,  train_recall = 0.9743,  train_f1 = 0.9729,  train_aucroc = 0.9956,  train_opt_accuracy = -1.0000,  train_threshold = -1.0000            
eval_loss = 1.5156,  eval_acc = 0.6480,  eval_prec = 0.3563,  eval_recall = 0.8381,  eval_f1 = 0.5000,  eval_aucroc = 0.7601,  eval_opt_accuracy = -1.0000,  eval_threshold = -1.0000                
lr  =  0.00002927
Elapsed Time:  00:29:56.90
23/02/2021 01:49:48 PM : INFO - Training terminated early because the Validation aucroc did not improve for  5.0  epochs

----------------------------------------------------------------------------------------------------

--------------------------------------------------
Best Validation scores:
--------------------------------------------------

Val accuracy of best model = 69.200
Val AUC-ROC of best model = 77.069
Val precision of best model = 53.846
Val recall of best model = 76.879
Val f1 of best model = 63.333

--------------------------------------------------
		Evaluating on test set
--------------------------------------------------
23/02/2021 01:49:48 PM : INFO - Using UNITER model ./model_checkpoints/meme.pt
23/02/2021 01:49:49 PM : INFO - Exporting dev_seen predictions...
23/02/2021 01:49:52 PM : INFO - Finished export of dev_seen predictions
23/02/2021 01:49:52 PM : INFO - Optimal threshold on validation dataset: 0.5000 (accuracy=69.20%)
23/02/2021 01:49:52 PM : INFO - Export and testing on test_seen...
23/02/2021 01:49:58 PM : INFO - Finished export of test predictions
